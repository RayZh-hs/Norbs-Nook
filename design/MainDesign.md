# Main Design for <u>Norb's Nook</u>

## Project Information

### Basic Facts

- **Project Name**: Norb's Nook (aka. The Nook, aka. Bookstore_2024);
- **Creator**: Norb (also known as RayZh)
- **Homepage**: https://github.com/RayZh-hs/Norbs-Nook

### Short Description

Norb's Nook is a creatively-crafted bookstore management system, written primarily in cpp, with a beautiful web-based frontend.
It provides clients with the ability to:

- Easily create and manage accounts.
- Sell and purchase books on the fly.
- (For customers) Enjoy a hinge-free browsing experience.
- (For salesmen) Easily monitor book info in the shop.
- (For the shop owner) Monitor all that happens in the shop at a glance.
- ...

## Technical Manual

This part is dedicated to the maintainers of this project.
If technical details don't concern you, feel free to skip it.

### Overview

The project is structured as follows:

- **design**: all dev-time manuals and design scripts reside here.
- **generated**: contains all data that are procedurally generated by the software.   
**[update] Later (due to OJ-related issues) it is removed in all OJ uploads, but in the frontend runtime the folders are moved into src/api/.**
    - **data**: this folder contains data blocks used internally to store information
    - **logs**: this folder contains logs of runtime actions, system info, etc.
- **requirements**: requirements for this project. it shouldn't concern you.
- **src**: \[important\] all scripts reside here.
    - **backend**: contains cpp code used to manage and handle data.
    - **bridge**: contains python flask scripts to bridge the web frontend to the cpp backend.   
      **[update] The folder is later renamed to api, and contains all flask api server implements**
    - **frontend**: contains web GUI-related files.
- **tests**: contains all tests.

Within the backend folder, the cpp files are divided as follows:

- **lib**: external libraries, self-built in earlier stages.
   - ***BlockList***: a library for efficient storing and retrieving of structured data.
   - ***NaiveList***: a library for simple storage of structured data. Behaves like a simple array.
  - **[update]** ***norb_alias***: some aliases to make life simpler.
  - **[update]** ***norb_con***: some predefined strings that color the output text.
  - **[update]** ***norb_string***: a self-defined string based on std::array.
  - **[update]** ***norb_strlib***: a library containing regex and string-related utils.
  - **[update]** ***norb_utils***: a library that extends the std library and implements easier file manipulation.
  - **[update]** ***json***: only used in GUI. original source: [**nlohmann/json**](https://github.com/nlohmann/json/).
- **static**: static files.
    - ***constants***: contains all constants for the project.
    - **[update] Later two separate versions of constants are used, one for OJ tests and one for GUI runtime builds. CMake dynamically decides which one to link.**
- ***account***: manages information about accounts.
- **bookkeeper**: manages information about books, purchases and restock.
- **logging**: manages the log files.
- **[update]** **global**: classes that enclose all global assets and variables and ensure that they are correctly constructed, linked and destructed.
- **[update]** **business_logic**: implements all the core business logic.
- **[update]** **user_interface**: builds upon business logic to provide the entire user interface.
- **main_gui/cui**: builds on all else and provides User Interface Access Points.

### The Main Function

The main function (in main_cui.cpp) relies on all the following classes:

- **[update]** **BusinessLogicInterface** defines all that the business logic can do.
- **[update]** **BusinessLogicImplement** implements all that functionality.
- **[update]** **CommandlineUserInterface** handles all the commandline interface.

These classes directly rely on the following classes (which are provided and injected via GlobalAssetManager):

- **AccountManager** (from account.hpp): for querying and managing accounts.
- **BookManager** (from bookkeeper.hpp): for maintaining book info in the shop.
- **ActionManager** (from bookkeeper.hpp): for maintaining actions.
- **Logger** (from logging.hpp): for creating logs and displaying them.

### Functionalities

#### Account Management 

1. add_user:
    - **Name**: addUser;
    - **Input**: userid `std::string`, category `enum`, time `int`
    - **Output**: None;
    - **Description**: Adds user to system;
2. del_user:
    - **Name**: delUser;
    - **Input**: userid `std::string`;
    - **Output**: success `bool`;
    - **Description**: Deletes user if it exists;
3. has_user:
4. chmod_user:
    - **Name**: chmodUser;
    - **Input**: userid `std::string`, category `enum`;
    - **Output**: success `bool`;
    - **Description**: Changes the category of a user if it exists;
5. switch_user:
    - **Name**: switchUser;
    - **Input**: userid `std::string` password `std::string`;
    - **Output**: success `bool`;
    - **Description**: Switches to a user (add to stack);
6. logout:
    - **Name**: logout;
    - **Description**: Logouts from the current user (pop from stack);
7. change_password:
    - **Name**: change_password
    - **Input**: userid `std::string` new_password `std::string` current_password `std::string`;

#### Book Management

1. query_book:
    - **Name**: queryBook;
    - **Input**: filter `Filter`;
    - **Output**: results `std::vector<Book>`;
    - **Description**: Queries all books that are selected by the filter;
2. buy:
    - **Name**: buy;
    - **Description**: Decrement the stock of a book by a specific number;
3. select:
    - **Name**: select;
    - **Description**: Select a book. Create one if the isbn is not found;
4. import:
  - **Name**: import;
  - **Description**: Increment the stock of a book by a specific number;

#### Logging

1. set_logger_mode
    - **Name**: set_logger_mode;
    - **Input**: mode `enum`;
    - **Description**: Set the screen logging standard;
2. log
    - **Name**: log;
    - **Input**: status `enum`, scope `std::string`, msg `std::string`, time `int`;
    - **Description**: Saves the log to disk and prints it the screen;
3. print_log
    - **Name**: print_log_within;
    - **Input**: status `enum`;
    - **Description**: Prints on the screen all log info on/above status;
4. clear_all_logs
    - **Name**: clear_all_logs;
    - **Description**: Clears all log files;

### Database Design

- ***log.log***: for storing all-time logs
- ***global.dat***: for storing all global variables
- ***uid_info.dat***: mapping the unique-id to the information of a book, using a NaiveList.
- ***isbn_uid-head.dat, isbn_uid-body.dat***: mapping the isbn to the uid, with a BlockList.
- ***author_uid-head.dat, author_uid-body.dat***: mapping an author to the uid, with a BlockList.
- ***title_uid-head.dat, title_uid-body.dat***: mapping a title to the uid, with a BlockList.
- ***keyword_uid-head.dat, keyword_uid-body.dat***: mapping a keyword to the uid, with a BlockList.

### Class Design

Since a lot of classes have been depicted in detail above, I will here only cover those that bear importance but have not yet been covered.

- **NaiveList** (from NaiveList.hpp): Saves unordered structured data in a list in the disk.
- **BlockList** (from BlockList.hpp): Saves ordered structured data in a block list in the disk.
- **Account** (from account.hpp): Embodies information of an account.
- **Book** (from bookkeeper.hpp): Embodies information of a book.
- **Action** (from bookkeeper.hpp): Embodies information of an action performed, which needs to be documented.
- ~~**[Deprecated]** **Filter** (from bookkeeper.hpp): Embodies information of all components of a query.~~
- ~~**[Deprecated]** **UserInterfaceBase** (from main.hpp): A system that handles all user interfaces.~~

## Additional Information

None, to the time when this document is created.

---

Made with :sparkling_heart: by Norb.

Last updated: Dec.29, 2024.